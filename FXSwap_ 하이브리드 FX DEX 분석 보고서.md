# FXSwap: 하이브리드 FX DEX 분석 보고서

## 1. 서론

FXSwap은 기관과 일반 사용자를 모두 대상으로 하는 혁신적인 코인 기반 외환(FX) 스왑 플랫폼입니다. 본 문서는 제공된 Notion 페이지의 정보를 바탕으로 FXSwap의 아키텍처, 핵심 기능, 운영 프로세스 및 리스크 관리 전략을 심층적으로 분석하고 종합적인 이해를 제공하는 것을 목표로 합니다.

FXSwap의 가장 큰 특징은 **하이브리드 풀(Hybrid Pool)**과 **가상 페어(Virtual-Pair)**라는 두 가지 핵심 기술을 통해 기존 탈중앙화 거래소(DEX)의 한계인 유동성 파편화 문제를 해결하고, 기관과 일반 사용자에게 각기 다른 최적화된 거래 환경을 제공한다는 점입니다. 기관에게는 실시간 환율 기반의 저렴하고 빠른 대규모 거래를, 일반 사용자에게는 AMM(Automated Market Maker) 기반의 손쉬운 접근성을 제공합니다.

본 보고서는 FXSwap의 시스템 구조부터 시작하여, 단일 풀과 페어풀의 장단점 비교, 유동성 공급 및 보상 메커니즘, 그리고 다층적인 환율 리스크 방어 전략에 이르기까지 상세히 다룰 것입니다.

## 2. FXSwap 시스템 아키텍처

FXSwap은 크게 **프론트엔드(Frontend)**, **서버 사이드(Server-side)**, 그리고 **스마트 컨트랙트(Smart Contract)**의 3개 레이어로 구성된 하이브리드 구조를 채택하고 있습니다. 이는 온체인의 탈중앙성과 투명성을 유지하면서도 오프체인 시스템의 효율성과 보안성을 결합하기 위함입니다.

### 2.1. 시스템 전체 구조도

```
┌───────────────────────────────────────────────────────────────────┐
│                        Frontend Layer                              │
│   ┌──────────────────┐         ┌─────────────────────┐           │
│   │   User DApp      │         │    Admin Tool       │           │
│   │ (Web3 Interface) │         │  (Operator Panel)   │           │
│   └──────────────────┘         └─────────────────────┘           │
└───────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌───────────────────────────────────────────────────────────────────┐
│                      Server Side Layer                             │
│   ┌────────────────────────────────────────────────────────────┐  │
│   │  - KYC/AML 검증                                            │  │
│   │  - 실시간 환율 조회 (외부 API)                             │  │
│   │  - 거래 승인 및 파라미터 생성                              │  │
│   │  - 오라클 가격 피드 (Reporter 역할)                        │  │
│   └────────────────────────────────────────────────────────────┘  │
└───────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌───────────────────────────────────────────────────────────────────┐
│                    Smart Contract Layer                            │
│   ┌─────────────────────────────────────────────────────────────┐│
│   │           HybridPoolManager (Core)                          ││
│   └─────────────────────────────────────────────────────────────┘│
│           ▼              ▼              ▼                         │
│   ┌──────────────┐ ┌──────────────┐ ┌──────────────┐            │
│   │Institutional │ │   Oracle     │ │     Fee      │            │
│   │  Registry    │ │  Validator   │ │ Distributor  │            │
│   └──────────────┘ └──────────────┘ └──────────────┘            │
│                           ▼                                        │
│   ┌─────────────────────────────────────────────────────────────┐│
│   │                    PoolFactory                              ││
│   └─────────────────────────────────────────────────────────────┘│
│                           ▼                                        │
│   ┌────────┬────────┬────────┬────────┬─────────────────────────┐│
│   │  USGX  │  KRGX  │  JPGX  │  PHGX  │   ... (확장 가능)       ││
│   │  Pool  │  Pool  │  Pool  │  Pool  │                         ││
│   └────────┴────────┴────────┴────────┴─────────────────────────┘│
└───────────────────────────────────────────────────────────────────┘
```

### 2.2. 주요 컴포넌트 역할

| 컴포넌트 | 주요 역할 |
| :--- | :--- |
| **FXSwapMaster** | 시스템의 중앙 관리 컨트랙트로, 모든 하위 컴포넌트를 배포하고 전체 시스템의 Owner, Operator 등 주요 역할을 관리합니다. |
| **HybridPoolManager** | 스왑 실행의 핵심 오케스트레이션을 담당하며, 사용자가 기관인지 일반 사용자인지에 따라 다른 스왑 로직(실시간 환율 또는 AMM)을 호출합니다. |
| **InstitutionalRegistry** | 기관 사용자의 등록, KYC/AML 상태, 거래 한도, 맞춤형 수수료율 등 모든 정보를 관리하고 검증하는 역할을 수행합니다. |
| **PriceOracle** | 서버 사이드에서 제공하는 실시간 환율 데이터를 온체인에 기록하고, 스왑 시 가격 데이터의 유효성(시간, 편차, 신뢰도)을 검증합니다. |
| **PoolFactory** | 새로운 외환 스테이블 코인이 추가될 때 해당 코인의 단일 풀을 생성하고 시스템에 등록하는 역할을 합니다. |
| **HybridStablePool** | 각 외환 스테이블 코인의 유동성이 실제로 보관되는 단일 풀입니다. 기관과 일반 사용자의 유동성이 통합되어 관리됩니다. |
| **FeeDistributor** | 발생한 스왑 수수료를 수집하여 유동성 공급자(LP)들의 지분에 따라 분배하는 역할을 담당합니다. |

## 3. 단일 풀 vs 하이브리드 풀: 구조적 선택 분석

FXSwap의 핵심 설계 결정 중 하나는 유동성을 관리하는 풀의 구조입니다. 초기에는 모든 유동성을 하나의 풀에 집중시키는 **단일 풀(Single Pool)** 방식과, 사용자 유형(기관/일반)에 따라 풀을 분리하는 **분리 풀(Separated Pool)** 방식이 고려되었습니다. 그러나 두 방식 모두 명확한 장단점을 가지고 있어, 최종적으로 이 둘의 장점을 결합한 **하이브리드 듀얼 레이어(Hybrid Dual-Layer)** 방식이 최적의 대안으로 제시되었습니다.

### 3.1. 모델별 비교 분석

| 평가 항목 | 단일 풀 (공유) | 분리 풀 (독립) | 하이브리드 (최적안) |
| :--- | :--- | :--- | :--- |
| **자본 효율성** | 🟢 최상 (유동성 집중) | 🔴 최하 (유동성 파편화) | 🟡 우수 (코어 풀 + 전용 풀) |
| **스왑 효율성** | 🟢 최상 (슬리피지 최소화) | 🔴 최하 (슬리피지 극대화) | 🟡 우수 (거래량에 따라 최적 풀 선택) |
| **수익 공정성** | 🔴 최하 (기여-분배 불일치) | 🟢 최상 (완벽한 분리) | 🟢 최상 (풀별 독립적 수익 분배) |
| **리스크 관리** | 🔴 위험 (리스크 전파) | 🟢 안전 (리스크 격리) | 🟡 안전 (코어 풀 리스크 + 격리) |
| **관리 복잡도** | 🟢 단순 | 🔴 복잡 (풀 개수 2배) | 🟡 중간 (계층적 구조) |
| **종합 평가** | 72 / 100 | 58 / 100 | **88 / 100** |

### 3.2. 단일 풀의 문제점: 수익 불공정성

단일 풀은 자본 효율성을 극대화하지만, **수익 분배의 불공정성**이라는 치명적인 문제를 야기합니다. 예를 들어, 낮은 수수료로 대규모 거래를 일으키는 기관과 높은 수수료로 소규모 거래를 하는 일반 사용자의 유동성이 섞여 있을 경우, 발생한 전체 수수료는 유동성 지분에 따라 분배됩니다. 이 과정에서 수수료 기여도가 낮은 기관이 더 많은 수익을 가져가고, 기여도가 높은 일반 사용자는 오히려 손실을 보는 역전 현상이 발생할 수 있습니다.

### 3.3. 하이브리드 듀얼 레이어: 최적의 타협점

이러한 문제를 해결하기 위해 제안된 하이브리드 모델은 다음과 같은 계층적 구조를 가집니다.

- **Layer 1: 공용 코어 풀 (Base Pool)**
  - 전체 유동성의 약 50%를 차지하며, 기관과 일반 사용자 모두 접근 가능합니다.
  - 대규모 거래를 처리하여 슬리피지를 최소화하고, 이 풀에서 발생하는 수수료는 기여도에 따라 공정하게 분배됩니다.

- **Layer 2: 전용 풀 (Dedicated Pool)**
  - 나머지 유동성은 기관 전용 풀과 일반 사용자 전용 풀로 분리됩니다.
  - 각 풀에서 발생하는 거래는 해당 풀의 유동성 공급자에게만 독립적으로 수수료가 분배되어 수익의 공정성을 100% 보장합니다.

스마트 컨트랙트는 거래의 규모와 사용자 유형을 판단하여 가장 효율적인 풀(코어 풀 또는 전용 풀)을 자동으로 선택하여 스왑을 실행합니다. 이 구조를 통해 FXSwap은 **자본 효율성과 수익 공정성**이라는 두 마리 토끼를 모두 잡는 최적의 균형점을 찾았습니다.

## 4. 핵심 운영 프로세스

FXSwap의 안정적이고 효율적인 운영은 체계적으로 정의된 온보딩, 유동성 관리, 스왑 실행 프로세스를 통해 보장됩니다.

### 4.1. 기관 온보딩 프로세스

기관 사용자는 일반 사용자와 달리 별도의 심사 및 등록 절차를 거쳐야 합니다. 이는 보안을 강화하고 기관별 맞춤형 서비스를 제공하기 위함입니다.

1.  **기본 정보 등록 (`registerInstitution`)**: 기관이 자신의 기본 정보를 컨트랙트에 등록하며, 이때 상태는 `PENDING`으로 설정됩니다.
2.  **오프체인 KYC/AML 검증**: FXSwap 운영팀은 별도의 오프체인 프로세스를 통해 기관의 신원 및 자금세탁방지 관련 검증을 수행합니다.
3.  **기관 활성화 (`activateInstitution`)**: 검증이 완료되면, Operator는 해당 기관의 거래 한도, 수수료율 등 맞춤형 파라미터를 설정하고 상태를 `ACTIVE`로 변경합니다.
4.  **코인 및 풀 접근 권한 부여 (`allowCoinForInstitution`, `authorizePoolForInstitution`)**: 마지막으로, 해당 기관이 거래할 수 있는 외환 코인의 종류와 접근 가능한 유동성 풀에 대한 권한을 부여합니다.

### 4.2. 유동성 공급 및 제거

FXSwap의 유동성은 **Virtual-Pair**라는 독특한 방식을 통해 공급됩니다. 이는 사용자가 두 개의 다른 단일 풀에 동시에 유동성을 공급하고, 이를 하나의 **가상 LP 토큰(Virtual LP Token)**으로 관리하는 방식입니다. 이를 통해 자본 효율성을 높이고 관리의 편의성을 제공합니다.

-   **유동성 공급 (`addLiquidity`)**: 사용자가 두 풀에 각각 자산을 예치하면, 컨트랙트는 두 자산의 가치를 기반으로 `sqrt(amount1 * amount2)` 또는 상대적 기여도 공식을 사용하여 Virtual LP 토큰을 발행합니다. 사용자의 지분은 이 LP 토큰으로 표시됩니다.
-   **유동성 제거 (`removeLiquidity`)**: 사용자가 자신의 Virtual LP 토큰을 소각하면, 컨트랙트는 해당 지분만큼의 기초 자산과 그동안 누적된 수수료 수익을 계산하여 사용자에게 반환합니다.

### 4.3. 스왑 실행 프로세스

스왑 프로세스는 사용자의 유형에 따라 완전히 다른 두 가지 경로로 실행됩니다.

#### 일반 사용자 스왑 (AMM 기반)

1.  **스왑 요청**: 사용자가 DApp을 통해 스왑을 요청합니다.
2.  **사용자 유형 확인**: 컨트랙트는 요청자가 일반 사용자임을 확인합니다.
3.  **AMM 기반 계산 (`_swapRetail`)**: 유동성 풀의 자산 비율에 기반한 AMM 공식(e.g., `x * y = k`)을 사용하여 교환될 토큰의 양을 계산합니다. 이때 유동성 비율에 따른 **동적 수수료**가 적용됩니다.
4.  **자산 교환**: 계산된 양의 토큰이 사용자에게 전송되고, 풀의 자산 상태가 업데이트됩니다.

#### 기관 사용자 스왑 (실시간 환율 기반)

1.  **오프체인 사전 확인**: 서버 사이드에서 기관의 KYC 상태, 거래 한도, 권한 등을 사전에 확인합니다.
2.  **실시간 환율 업데이트 (`updatePrice`)**: 서버는 외부 API로부터 받은 최신 환율을 `PriceOracle` 컨트랙트에 업데이트합니다.
3.  **스왑 요청**: 기관이 서명된 거래 요청을 제출합니다.
4.  **가격 및 권한 검증**: 컨트랙트는 `PriceOracle`의 데이터가 유효한지(5분 이내, 허용 편차 이내), 그리고 해당 기관이 거래 권한을 가졌는지 검증합니다.
5.  **실시간 환율 기반 계산 (`_swapInstitutional`)**: 검증된 오라클 가격을 직접 적용하여 `amountOut = amountIn × oraclePrice` 공식으로 교환될 금액을 정확하게 계산합니다. 이때 기관별 맞춤형 수수료가 적용됩니다.
6.  **자산 교환 및 거래량 기록**: 자산이 교환되고, 기관의 일일 거래량이 기록됩니다.

## 5. 환율 리스크 방어 전략

외환 시장의 변동성은 DEX의 안정성을 위협하는 가장 큰 요소입니다. FXSwap은 이러한 리스크를 효과적으로 관리하기 위해 다음과 같은 다층적인 방어 전략을 구축했습니다.

### 5.1. 1단계: 환율 변동 준비금 (Exchange Rate Risk Reserve)

-   **역할**: 급격한 환율 변동으로 인해 발생하는 풀의 손실을 보전하기 위한 보험 기금입니다.
-   **재원**: 각 풀 유동성의 5-10%를 별도로 확보하며, 손실 발생 시 자동으로 보전하고 부족분은 거래 수수료 수익으로 재충전합니다.
-   **이원화 관리**: 일반 사용자의 소액 손실을 위한 **일반 준비금**과 기관의 대규모 거래 손실을 위한 **기관 준비금**으로 분리하여 운영함으로써, 리스크를 격리하고 사용자 유형별로 차별화된 보상 정책을 적용합니다.

### 5.2. 2단계: 동적 수수료 조정 (Dynamic Fee Adjustment)

-   **역할**: 시장 상황에 따라 거래 비용을 실시간으로 조정하여 과도한 거래를 억제하고 풀의 균형을 유지합니다.
-   **조정 로직**: `조정수수료 = 기본수수료 × (1 + 사용률계수 + 변동성계수)` 공식을 사용합니다.
-   **효과**: 풀의 사용률이 높거나(유동성 부족) 환율 변동성이 클 때 수수료가 자동으로 인상되어, 시장이 안정될 때까지 거래 속도를 조절하는 효과를 가집니다.

| 상황 | 기본수수료 | 사용률 | 변동성 | 최종 조정수수료 |
| :--- | :--- | :--- | :--- | :--- |
| 정상 | 0.3% | 50% | 0.5% | **0.3%** |
| 높은 사용률 | 0.3% | 85% | 0.5% | **0.41%** |
| 높은 변동성 | 0.3% | 50% | 2.0% | **0.36%** |
| 둘 다 높음 | 0.3% | 90% | 3.0% | **0.63%** |

### 5.3. 3단계: 스왑 크기 제한 및 가격 검증

-   **스왑 크기 제한**: 단일 거래가 풀에 미치는 영향을 제한하기 위해, 전체 유동성의 일정 비율(e.g., 5%)을 초과하는 스왑은 차단됩니다. 이를 통해 고래에 의한 가격 조작 시도를 방지합니다.
-   **오라클 가격 검증**: 기관 거래 시 사용되는 오라클 가격은 컨트랙트 레벨에서 **시간(Timestamp), 편차(Deviation), 신뢰도(Confidence)**의 3중 검증을 거칩니다. 오래되거나, 이전 가격과 차이가 크거나, 신뢰도가 낮은 데이터는 거부되어 시스템을 보호합니다.

### 5.4. 4단계: 서킷 브레이커 (Circuit Breaker)

-   **역할**: 최후의 방어선으로, 시스템에 감지된 심각한 위협(e.g., 플래시론 공격, 대규모 인출 패닉)이 발생했을 때 관련 거래를 일시적으로 중단시키는 자동화된 안전장치입니다.
-   **작동 조건**: 특정 시간 내 과도한 가격 변동, 유동성 급감, 연속적인 대규모 거래 등 사전에 정의된 위험 시나리오가 감지되면 자동으로 발동됩니다.
-   **효과**: 공격자가 시스템을 악용할 시간을 차단하고, 운영팀이 상황을 분석하고 대응할 수 있는 시간을 확보하여 자산 손실을 방지합니다.

## 6. 결론

FXSwap은 기존 DEX의 한계를 명확히 인식하고, 기관과 일반 사용자라는 이질적인 두 그룹의 요구사항을 동시에 충족시키기 위해 설계된 정교한 하이브리드 FX 프로토콜입니다. 본 분석을 통해 도출된 FXSwap의 핵심 경쟁력과 특징은 다음과 같습니다.

-   **혁신적인 풀 구조**: 자본 효율성과 수익 공정성 사이의 트레이드오프를 해결하기 위해 **하이브리드 듀얼 레이어**라는 독창적인 풀 구조를 제안했습니다. 이는 장기적으로 DEX가 확장성과 공정성을 모두 달성할 수 있는 최적의 모델이 될 수 있음을 시사합니다.

-   **이원화된 거래 시스템**: 기관에게는 오라클 기반의 정밀하고 저렴한 거래를, 일반 사용자에게는 친숙한 AMM 기반의 거래 환경을 제공함으로써, 단일 플랫폼 내에서 두 사용자 그룹을 모두 성공적으로 유치할 수 있는 기반을 마련했습니다.

-   **다층적 리스크 관리**: 단순한 가격 피드를 넘어, 환율 변동 준비금, 동적 수수료, 스왑 크기 제한, 그리고 서킷 브레이커에 이르는 **4단계 방어 전략**은 외환 시장의 예측 불가능한 변동성 속에서도 플랫폼의 안정성과 자산의 안전을 보장하는 강력한 안전장치 역할을 합니다.

-   **체계적인 운영 프로세스**: 명확하게 정의된 기관 온보딩, 유동성 관리, 스왑 실행 프로세스는 FXSwap이 단순한 기술적 실험을 넘어, 실제 금융 시장의 요구사항을 충족할 수 있는 실용적이고 신뢰할 수 있는 서비스로 성장할 잠재력을 가지고 있음을 보여줍니다.

결론적으로 FXSwap은 탈중앙화 금융(DeFi)이 어떻게 전통적인 외환 시장의 복잡성과 요구사항을 수용하며 진화할 수 있는지 보여주는 중요한 사례입니다. 현재의 단일 풀 구조는 초기 단계에 적합하지만, 장기적으로는 제안된 하이브리드 모델로의 진화가 FXSwap을 FX DeFi 분야의 선도적인 플랫폼으로 만드는 핵심 동력이 될 것입니다.
