# 유동성 및 보상

이 섹션은 FXSwap 플랫폼 내 유동성 제공, LP 토큰 메커니즘, 수수료 누적 및 보상 분배에 대한 포괄적인 개요를 제공합니다. 소매 및 기관 사용자 모두를 위한 효율적인 FX 스테이블코인 스왑을 촉진하도록 설계된 FXSwap은 하이브리드 유동성 풀 아키텍처와 동적 수수료 메커니즘을 활용하여 거래 경험을 최적화하고 유동성 제공자에게 인센티브를 제공하도록 설계되었습니다.

---

## 유동성 제공

FXSwap의 유동성 제공은 USGX(USD 페그), KRGX(KRW 페그), JPGX(JPY 페그) 및 PHGX(PHP 페그)와 같은 계획된 주권 스테이블코인 간의 원활한 스왑을 가능하게 하도록 설계되었습니다. 각 스테이블코인 쌍은 깊이와 효율성을 극대화하기 위해 소매 및 기관 유동성을 모두 통합하는 **단일 하이브리드 유동성 풀**을 통해 서비스될 예정입니다.

### Virtual-Pair 메커니즘

FXSwap의 유동성은 **Virtual-Pair**라는 독특한 방식을 통해 공급됩니다. 이는 전통적인 페어 풀(Pair Pool) 방식과 구별되는 혁신적인 접근법입니다:

**전통적인 페어 풀 방식의 문제점**:
- USGX-KRGX, USGX-JPGX, KRGX-JPGX 등 모든 통화 쌍마다 별도의 풀이 필요
- n개의 통화가 있을 때 n×(n-1)/2개의 풀이 필요 (예: 4개 통화 = 6개 풀)
- 유동성이 파편화되어 자본 효율성 저하
- 관리 및 배포 비용 증가

**Virtual-Pair 방식의 장점**:
- 각 스테이블코인마다 **단일 풀(Single Pool)**만 생성
- 사용자가 두 개의 다른 단일 풀에 동시에 유동성을 공급
- 하나의 **가상 LP 토큰(Virtual LP Token)**으로 관리
- n개의 통화에 대해 n개의 풀만 필요 (예: 4개 통화 = 4개 풀)
- 유동성이 집중되어 자본 효율성 최대화
- 관리 복잡도 약 66% 감소

### 유동성 추가 방법 (Virtual-Pair 기반)

Virtual-Pair 메커니즘을 사용하는 유동성 추가는 다음과 같은 프로세스를 따릅니다:

**예시: USGX-KRGX 거래 쌍에 유동성 공급**

1. **두 개의 단일 풀에 동시 예치**:
   - LP는 USGX 풀에 1,000 USGX를 예치
   - 동시에 KRGX 풀에 1,300,000 KRGX를 예치

2. **가상 LP 토큰 발행**:
   - 두 자산의 가치를 기반으로 Virtual LP 토큰을 발행
   - 첫 번째 유동성 추가 시:
     \[
     \text{virtualLP} = \sqrt{\text{amount}_{\text{USGX}} \times \text{amount}_{\text{KRGX}}}
     \]
   - 후속 유동성 추가 시:
     \[
     \text{virtualLP} = \min\left(\frac{\text{amount}_{\text{USGX}}}{\text{reserve}_{\text{USGX}}}, \frac{\text{amount}_{\text{KRGX}}}{\text{reserve}_{\text{KRGX}}}\right) \times \text{totalVirtualLP}
     \]

3. **지분 관리**:
   - 하나의 Virtual LP 토큰으로 두 풀에 대한 지분을 표시
   - 수수료 수익은 두 풀 모두에서 발생하여 LP에게 분배

**유동성 제거 (`removeLiquidity`)**:
- LP가 Virtual LP 토큰을 소각하면
- 두 풀에서 지분에 해당하는 자산을 동시에 인출
- 누적된 수수료 수익도 함께 수령

이 방식을 통해 LP는 복잡한 관리 없이 효율적으로 다중 통화 쌍에 유동성을 제공할 수 있습니다.

### 하이브리드 풀 설계

FXSwap은 스테이블코인 쌍당 단일 풀 내에서 기관 및 소매 유동성을 통합하는 **하이브리드 풀** 모델을 사용합니다. 이 설계는 여러 이점을 제공합니다:

- **유동성 극대화**: 두 사용자 유형을 결합하면 더 깊은 유동성과 감소된 슬리피지가 발생합니다.
- **운영 효율성**: 단일 풀 관리는 복잡성과 배포 비용을 줄입니다.
- **내부 분리**: 프라이버시와 규정 준수를 유지하기 위해 기관 및 소매 참여자의 잔액이 풀 내에서 별도로 추적됩니다.

---

## LP 토큰 메커니즘

유동성 제공자는 풀에 대한 기여에 비례하여 LP 토큰을 받습니다. 이러한 토큰은 소유권 증명 역할을 하며 보유자에게 누적된 스왑 수수료 및 보상의 지분을 받을 자격을 부여합니다.

### LP 토큰의 주요 특성

| 기능 | 설명 |
|-----------------------|------------------------------------------------------------------------------------------------|
| **표현** | 유동성 풀의 비례 소유권을 나타내는 양도 불가능한 토큰 |
| **발행** | 풀 준비금에 대한 기여를 기반으로 유동성 추가 시 발행 |
| **소각** | 유동성이 인출될 때 상환되어 제공자의 지분이 그에 따라 감소 |
| **보상 자격** | 보유자는 LP 토큰 보유량에 따라 스왑 수수료 및 보상의 비례 지분을 누적 |

LP 토큰은 유동성 지분을 추적하고 분배 주기 동안 보상 자격을 계산하는 데 필수적입니다.

---

## 수수료 누적

FXSwap은 풀 내에서 실행되는 모든 스왑 거래에서 수수료를 생성합니다. 이러한 수수료는 여러 목적을 제공합니다: 유동성 제공을 인센티브화하고, 풀 균형을 유지하며, 운영 비용을 충당합니다.

### 수수료 구조

- **소매 사용자**: 수수료는 Uniswap v3 스타일 AMM 모델을 따르는 풀 불균형을 기반으로 동적으로 계산됩니다. 수수료율은 기본 및 견적 자산 간의 균형 잡힌 1:1 유동성 비율에서 1% 편차마다 1%씩 증가합니다. 이 동적 수수료 메커니즘은 재균형을 장려하고 역선택으로부터 보호합니다.

- **기관 사용자**: 수수료는 일반적으로 약 0.1%로 고정되어 실시간 환율 기반 스왑에 적용됩니다. 기관 수수료는 최소 슬리피지로 대량 거래를 수용하기 위해 더 낮습니다.

### 수수료 누적 프로세스

스왑에서 수집된 수수료는 풀의 **accumulatedFees** 준비금에 누적됩니다. 이 준비금은 거래 활동이 발생함에 따라 지속적으로 증가하며 LP에 대한 후속 보상 분배의 기초를 형성합니다.

---

## 보상 분배

유동성 제공자에 대한 보상 분배는 **FeeDistributor** 컨트랙트를 통해 관리되며, 24시간 주기로 발생하여 유동성 제공에 대한 시기적절하고 예측 가능한 보상을 보장합니다.

### FeeDistributor 역할

**FeeDistributor**는 발생한 스왑 수수료를 수집하여 유동성 공급자(LP)들의 지분에 따라 공정하게 분배하는 전담 컨트랙트입니다:

- **수수료 수집**: 모든 HybridStablePool에서 발생한 수수료를 자동으로 수집
- **분리된 회계**: 소매 풀 수수료와 기관 풀 수수료를 별도로 추적
- **비례 분배**: LP 토큰 보유량에 정확히 비례하여 보상 계산
- **효율적인 청구**: 가스 효율적인 일괄 분배 및 청구 메커니즘

### 분배 워크플로

1. **수수료 누적**: 
   - 24시간 동안 스왑 수수료가 각 풀에서 발생
   - FeeDistributor가 실시간으로 수수료를 추적
   - 소매 거래 수수료와 기관 거래 수수료가 별도로 기록

2. **분배 실행**: 
   - 각 주기가 끝나면 `distributeRewards()` 함수가 자동으로 실행
   - 또는 거버넌스/운영자가 수동으로 실행 가능
   - LP 토큰 보유자에게 수수료를 비례적으로 할당

3. **지분 계산**: 
   - 각 LP의 보상 지분은 총 유동성에 대한 LP 토큰 잔액을 기반으로 계산:
   \[
   \text{reward}_{\text{LP}} = \text{totalFees} \times \frac{\text{lpTokens}_{\text{LP}}}{\text{totalLPTokens}}
   \]

4. **보상 할당**: 
   - 계산된 보상이 각 LP의 **accumulatedRewards** 잔액에 적립
   - 온체인에 투명하게 기록되어 검증 가능

5. **보상 청구**: 
   - LP는 `claimRewards()` 함수를 통해 언제든지 보상을 청구
   - 누적된 수수료의 지분을 자신의 지갑으로 인출
   - 가스 비용 절감을 위해 여러 풀의 보상을 한 번에 청구 가능

### 수수료 분배 예시

**시나리오**: 24시간 동안 USGX-KRGX 풀에서 1,000 USGX 상당의 수수료가 발생

- **LP A**: 10,000 Virtual LP 토큰 보유 (전체의 40%)
  - 보상: 400 USGX 상당
  
- **LP B**: 7,500 Virtual LP 토큰 보유 (전체의 30%)
  - 보상: 300 USGX 상당
  
- **LP C**: 5,000 Virtual LP 토큰 보유 (전체의 20%)
  - 보상: 200 USGX 상당
  
- **기타 LP**: 2,500 Virtual LP 토큰 보유 (전체의 10%)
  - 보상: 100 USGX 상당

각 LP는 자신의 지분에 정확히 비례하여 수수료를 받습니다.

---

## 요약 테이블: 유동성 및 보상 수명 주기

| 측면 | 설명 |
|-----------------------|------------------------------------------------------------------------------------------------|
| **유동성 제공** | 풀에 기본 및 견적 스테이블코인을 추가; 기여에 비례하여 LP 토큰 수령 |
| **LP 토큰** | 소유 지분을 나타냄; 입금 시 발행, 인출 시 소각 |
| **수수료 생성** | 스왑 거래는 동적(소매) 또는 고정(기관) 수수료를 발생시키며 풀에 누적 |
| **동적 수수료 모델** | 소매 수수료는 균형을 장려하기 위해 풀 불균형에 따라 증가 |
| **보상 주기** | LP 토큰 지분에 따라 24시간마다 수수료 분배 |
| **보상 청구** | LP는 분배 후 언제든지 누적된 보상을 청구 가능 |

---

## 결론

FXSwap 유동성 및 보상 시스템은 유동성 제공자에게 강력하고 효율적이며 공정한 환경을 제공하도록 설계되었습니다. 하이브리드 풀, 동적 수수료 및 투명한 보상 주기를 결합함으로써 FXSwap은 소매 및 기관 참여자의 이익과 일치하는 깊은 유동성, 최소화된 슬리피지 및 일관된 인센티브를 제공할 것입니다. 이 설계는 주권 스테이블코인에 의해 고정된 글로벌, 상호 운용 가능한 FX 및 DeFi 허브라는 더 넓은 Gurufin Chain 비전을 지원합니다.

